<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meeting Agenda Planner</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      margin: 0;
      min-height: 100vh;
    }

    input:focus {
      outline: 2px solid #3B82F6;
      outline-offset: 2px;
    }

    input[type="range"] {
      cursor: pointer;
    }

    input[type="color"] {
      cursor: pointer;
    }

    #root {
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@hello-pangea/dnd@18.0.1/dist/dnd.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { DragDropContext, Droppable, Draggable } = window.DND;

    function App() {
      const [meetingName, setMeetingName] = useState("Meeting Agenda Planner");
      const [duration, setDuration] = useState(60);
      const [topics, setTopics] = useState([
        { id: "1", name: "Introductions", time: 10, color: "#4F46E5" },
        { id: "2", name: "Project Updates", time: 20, color: "#10B981" },
        { id: "3", name: "Discussion", time: 20, color: "#F59E0B" },
        { id: "4", name: "Wrap-up", time: 10, color: "#EF4444" },
      ]);

      const [isPlaying, setIsPlaying] = useState(false);
      const [elapsedSeconds, setElapsedSeconds] = useState(0);
      const timerRef = useRef(null);

      const totalAllocated = topics.reduce((a, t) => a + t.time, 0);
      const remaining = duration - totalAllocated;

      useEffect(() => {
        const savedData = localStorage.getItem("agendaData");
        if (savedData) {
          const parsed = JSON.parse(savedData);
          setMeetingName(parsed.meetingName || "Meeting Agenda Planner");
          setDuration(parsed.duration || 60);
          setTopics(parsed.topics || []);
        }
      }, []);

      useEffect(() => {
        localStorage.setItem(
          "agendaData",
          JSON.stringify({ meetingName, duration, topics })
        );
      }, [meetingName, duration, topics]);

      useEffect(() => {
        if (isPlaying) {
          const startTime = Date.now() - elapsedSeconds * 1000;
          timerRef.current = setInterval(() => {
            const secondsPassed = Math.floor((Date.now() - startTime) / 1000);
            if (secondsPassed >= duration * 60) {
              clearInterval(timerRef.current);
              setIsPlaying(false);
              setElapsedSeconds(duration * 60);
            } else {
              setElapsedSeconds(secondsPassed);
            }
          }, 1000);
        }
        return () => clearInterval(timerRef.current);
      }, [isPlaying, duration]);

      const handlePlayPause = () => setIsPlaying((p) => !p);
      const handleRestart = () => {
        setElapsedSeconds(0);
        setIsPlaying(false);
      };

      const handleDragEnd = (result) => {
        if (!result.destination) return;
        const reordered = Array.from(topics);
        const [moved] = reordered.splice(result.source.index, 1);
        reordered.splice(result.destination.index, 0, moved);
        setTopics(reordered);
      };

      const handleRenameTopic = (id, newName) => {
        setTopics((prev) =>
          prev.map((t) => (t.id === id ? { ...t, name: newName } : t))
        );
      };

      const handleTimeChange = (id, val) => {
        setTopics((prev) =>
          prev.map((t) => (t.id === id ? { ...t, time: Number(val) } : t))
        );
      };

      const handleColorChange = (id, newColor) => {
        setTopics((prev) =>
          prev.map((t) => (t.id === id ? { ...t, color: newColor } : t))
        );
      };

      const handleAdd = () => {
        const newId = Date.now().toString();
        const colors = ["#4F46E5", "#10B981", "#F59E0B", "#EF4444", "#3B82F6"];
        setTopics([
          ...topics,
          {
            id: newId,
            name: "New Section",
            time: 1,
            color: colors[Math.floor(Math.random() * colors.length)],
          },
        ]);
      };

      const handleDelete = (id) => {
        setTopics((prev) => prev.filter((t) => t.id !== id));
      };

      const linePosition = (elapsedSeconds / (duration * 60)) * 100;

      return (
        <div
          style={{
            height: "100vh",
            width: "100vw",
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            background: "black",
          }}
        >
          <div
            style={{
              padding: "2rem",
              fontFamily: "sans-serif",
              maxWidth: 600,
              width: "90%",
              background: "#121212",
              borderRadius: "12px",
              boxShadow: "0 4px 20px rgba(255,255,255,0.1)",
              color: "white",
            }}
          >
            <input
              type="text"
              value={meetingName}
              onChange={(e) => setMeetingName(e.target.value)}
              style={{
                width: "100%",
                background: "transparent",
                border: "none",
                color: "white",
                fontSize: "1.5rem",
                fontWeight: "bold",
                textAlign: "center",
                marginBottom: "1rem",
              }}
            />

            <div style={{ marginBottom: 10, textAlign: "center" }}>
              <label>Duration (minutes): </label>
              <input
                type="number"
                value={duration}
                onChange={(e) => setDuration(Number(e.target.value))}
                style={{
                  width: 60,
                  marginLeft: 10,
                  background: "#1e1e1e",
                  border: "1px solid #333",
                  color: "white",
                  borderRadius: 4,
                  padding: "2px 4px",
                }}
              />
              <p style={{ color: remaining < 0 ? "red" : "#aaa" }}>
                Remaining time: {remaining} min
              </p>
            </div>

            <div
              style={{
                display: "flex",
                justifyContent: "center",
                gap: "10px",
                marginBottom: "1rem",
              }}
            >
              <button
                onClick={handlePlayPause}
                style={{
                  background: isPlaying ? "#F59E0B" : "#10B981",
                  color: "white",
                  border: "none",
                  borderRadius: "6px",
                  padding: "8px 14px",
                  cursor: "pointer",
                  fontWeight: "bold",
                }}
              >
                {isPlaying ? "Pause ‚è∏Ô∏è" : "Play ‚ñ∂Ô∏è"}
              </button>
              <button
                onClick={handleRestart}
                style={{
                  background: "#3B82F6",
                  color: "white",
                  border: "none",
                  borderRadius: "6px",
                  padding: "8px 14px",
                  cursor: "pointer",
                  fontWeight: "bold",
                }}
              >
                Restart üîÅ
              </button>
            </div>

            <button
              onClick={handleAdd}
              style={{
                background: "#3B82F6",
                color: "white",
                border: "none",
                padding: "8px 14px",
                borderRadius: "6px",
                marginBottom: "10px",
                cursor: "pointer",
                width: "100%",
                fontWeight: "bold",
              }}
            >
              + Add Section
            </button>

            <div
              style={{
                position: "relative",
                height: 400,
                border: "1px solid #333",
                borderRadius: 8,
                overflow: "hidden",
                marginTop: 10,
                display: "flex",
                flexDirection: "column",
                background: "#1c1c1c",
              }}
            >
              <div
                style={{
                  position: "absolute",
                  top: `${linePosition}%`,
                  left: 0,
                  width: "100%",
                  height: "2px",
                  background: "red",
                  boxShadow:
                    "0 0 6px 2px white, 0 0 10px 4px rgba(255,255,255,0.6)",
                  zIndex: 2,
                  transition: "top 1s linear",
                }}
              ></div>

              <DragDropContext onDragEnd={handleDragEnd}>
                <Droppable droppableId="agenda">
                  {(provided) => (
                    <div
                      ref={provided.innerRef}
                      {...provided.droppableProps}
                      style={{
                        flexGrow: 1,
                        display: "flex",
                        flexDirection: "column",
                      }}
                    >
                      {topics.map((topic, index) => (
                        <Draggable
                          key={topic.id}
                          draggableId={topic.id}
                          index={index}
                        >
                          {(provided) => (
                            <div
                              ref={provided.innerRef}
                              {...provided.draggableProps}
                              {...provided.dragHandleProps}
                              style={{
                                height: `${(topic.time / duration) * 100}%`,
                                background: topic.color,
                                color: "white",
                                display: "flex",
                                alignItems: "center",
                                justifyContent: "space-between",
                                padding: "0 10px",
                                borderBottom: "1px solid rgba(255,255,255,0.3)",
                                position: "relative",
                                zIndex: 1,
                                ...provided.draggableProps.style,
                              }}
                            >
                              <input
                                type="text"
                                value={topic.name}
                                onChange={(e) =>
                                  handleRenameTopic(topic.id, e.target.value)
                                }
                                style={{
                                  background: "transparent",
                                  border: "none",
                                  color: "white",
                                  fontWeight: "bold",
                                  width: "45%",
                                }}
                              />

                              <div style={{ display: "flex", alignItems: "center" }}>
                                <input
                                  type="color"
                                  value={topic.color}
                                  onChange={(e) =>
                                    handleColorChange(topic.id, e.target.value)
                                  }
                                  style={{
                                    marginRight: 8,
                                    border: "none",
                                    width: 25,
                                    height: 25,
                                    cursor: "pointer",
                                    background: "transparent",
                                  }}
                                />
                                <input
                                  type="range"
                                  min="1"
                                  max={duration}
                                  value={topic.time}
                                  step="1"
                                  onChange={(e) =>
                                    handleTimeChange(topic.id, e.target.value)
                                  }
                                />
                                <span style={{ marginLeft: 8 }}>
                                  {topic.time}m
                                </span>
                                <button
                                  onClick={() => handleDelete(topic.id)}
                                  style={{
                                    marginLeft: 10,
                                    background: "rgba(255,255,255,0.3)",
                                    border: "none",
                                    color: "white",
                                    cursor: "pointer",
                                    borderRadius: "4px",
                                    padding: "2px 6px",
                                  }}
                                >
                                  ‚úï
                                </button>
                              </div>
                            </div>
                          )}
                        </Draggable>
                      ))}
                      {provided.placeholder}
                    </div>
                  )}
                </Droppable>
              </DragDropContext>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
